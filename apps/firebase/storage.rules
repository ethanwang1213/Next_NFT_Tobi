rules_version = '2';
service firebase.storage {
  match /b/{bucket}/o {
    match /users/{userId} {
      allow read: if true;
      match /icon/{fileName} {
        allow read: if true;
        allow write: if request.auth != null 
        	&& request.auth.uid == userId 
          && (
            request.resource == null
            || (
              request.resource.size < 10 * 400 * 400
              && request.resource.contentType == "image/png"
          	)
        	);
      }
      match /item/{itemId}/{fileName} {
        allow read: if true;
        allow write: if request.auth != null 
        	&& request.auth.uid == userId
          && request.resource.size < 10 * 1024 * 1024
          && (fileName == 'image.png' || fileName == 'model.glb');
      }
      // (Tobiratory app admin) copyright and license files for TCP
      match /tcp/copyright/files/{fileName} {
        allow read: if request.auth != null
          && request.auth.uid == userId;
        allow write: if request.auth != null
          && request.auth.uid == userId
          && request.resource.size < 20 * 1024 * 1024
          && request.resource.contentType.matches('image/jpeg|image/png|application/pdf');
        allow delete: if request.auth != null
          && request.auth.uid == userId;
      }
    }
    // (Common) temporary folder. Old files are automatically deleted.
    match /tmp/users/{userId}/{fileName} {
      allow read: if request.auth != null
        && request.auth.uid == userId;
      allow write: if request.auth != null
        && request.auth.uid == userId;
      allow delete: if request.auth != null
        && request.auth.uid == userId;
    }
     match /documents/{userId} {
      allow read: if true;
      match /{fileName} {
      	allow read: if true;
      	allow write: if true;
      }
    }
  }
}